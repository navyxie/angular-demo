"use strict";function redirectToPersonPage(){window.location.href=personPage}var personPage="/p2p/person.html",totalAmount=1e5;angular.module("loginApp").controller("LoginCtrl",function(e,a,t,s){var o="50%";a.dialogState=0,a.currentProcess=a.leftPercent=o,a.showLoginDialog=function(){a.dialogState=1},a.closeDialog=function(){a.dialogState=0},t.checkLogin(store.get("username"),store.get("password"),function(e){0===e.code&&redirectToPersonPage()}),s.getProduct({limit:1},function(e){if(0===e.code){var t=e.data[0];if(0>=t.amount_total)a.currentProcess=a.leftPercent="0%";else{var s=t.amount_total/totalAmount;s=s/2+.5,s=100*s.toFixed(3),s=s.toFixed(1),a.currentProcess=a.leftPercent=""+s+"%"}}else console.log(e),alert("获取产品信息失败")})}).controller("LoginDialogCtrl",function(e,a,t,s){function o(e,a){store.set("username",e),store.set("password",a)}var i="登录",n="注册",r="已",g="没",c=!1,l="",u=!0;e.userNameTip=e.pswTip=1,e.userName=e.userPassword="",e.showRegisterTip=1,e.showSignTip=0,e.showName=i,e.hasAccountText=r,e.checkName=function(){e.showName!==n&&t({url:"/api/aimibao_users",method:"GET",params:{filter:{where:{username:e.userName}}}}).success(function(a){a.length?(c=!0,e.userNameTip=0):(c=!1,e.userNameTip=1)}).error(function(e){console.log(e),alert("网络不好，请重试")})},e.register=function(){return e.userPassword||(l="密码不能为空",u=!1),6>e.userPassword.length||e.userPassword.length>12?(l="密码长度在6-12之间",u=!1,e.pswTip=0):(e.pswTip=1,u=!0),c&&(l="账号已存在，请更换",u=!1),u?(e.showName===i?t({url:"/api/aimibao_users/create_user",method:"POST",data:{username:e.userName,password:md5(e.userPassword)}}).success(function(){o(e.userName,md5(e.userPassword)),e.resetDialog(),redirectToPersonPage()}).error(function(e){console.log(e),11e3===e.error.code&&-1!==e.error.err.indexOf("insertDocument :: caused by :: 11000 E11000 duplicate key error index")||422===e.error.status?alert("账号已存在，请更换"):alert("服务器繁忙，请重试")}):e.showName===n&&s.checkLogin(e.userName,md5(e.userPassword),function(a){0===a.code?(o(e.userName,md5(e.userPassword)),redirectToPersonPage()):(console.log("login error:",a),alert("请确认账号和密码是否正确"))}),void 0):(alert(l),void 0)},e.resetDialog=function(){a.dialogState=0,e.userName=e.userPassword="",e.userNameTip=e.pswTip=1},e.cancelBubble=function(e){e.stopPropagation()},e.changeLogin=function(){e.showName===i?(e.showName=n,e.showRegisterTip=0,e.showSignTip=1,e.hasAccountText=g):(e.showName=i,e.showRegisterTip=1,e.showSignTip=0,e.hasAccountText=r),e.userNameTip=e.pswTip=1,u=!0,c=!1}}).controller("CashFlowCtrl",function(e,a){e.cashFlowLists=[],a.getCashFlow({limit:5,order:"create_time DESC"},function(a){0===a.code?e.cashFlowLists=_.each(a.data,function(e){var a=new Date(e.create_time);return e.showTime=a.getFullYear()+"-"+(1+a.getMonth())+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes(),e}):(console.log(a),alert("获取现金流数据不成功"))})});