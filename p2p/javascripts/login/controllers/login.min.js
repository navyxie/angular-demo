"use strict";function redirectToPersonPage(){window.location.href=personPage}var personPage="/p2p/person.html";angular.module("loginApp",["myApp.checkLogin"]).controller("LoginCtrl",function(e,r,o){var s="50%";r.dialogState=0,r.currentProcess=r.leftPercent=s,r.showLoginDialog=function(){r.dialogState=1},r.closeDialog=function(){r.dialogState=0},o.checkLogin(store.get("username"),store.get("password"),function(e){0===e.code&&redirectToPersonPage()})}).controller("LoginDialogCtrl",function(e,r,o,s){var a="登录",t="注册",n=!1,i="",u=!0;e.userNameTip=e.pswTip=1,e.userName=e.userPassword="",e.showRegisterTip=1,e.showSignTip=0,e.showName=a,e.checkName=function(){o({url:"/api/aimibao_users",method:"GET",params:{filter:{where:{username:e.userName}}}}).success(function(r){r.length?(n=!0,e.userNameTip=0):(n=!1,e.userNameTip=1)}).error(function(e){console.log(e),alert("网络不好，请重试")})},e.register=function(){return e.userPassword||(i="密码不能为空",u=!1),6>e.userPassword.length||e.userPassword.length>12?(i="密码长度在6-12之间",u=!1,e.pswTip=0):(e.pswTip=1,u=!0),n&&(i="账号已存在，请更换",u=!1),u?(e.showName===a?o({url:"/api/aimibao_users",method:"POST",data:{username:e.userName,password:md5(e.userPassword)}}).success(function(){store.set("username",e.userName),store.set("password",md5(e.userPassword)),e.resetDialog(),redirectToPersonPage()}).error(function(e){console.log(e),11e3===e.error.code&&-1!==e.error.err.indexOf("insertDocument :: caused by :: 11000 E11000 duplicate key error index")?alert("账号已存在，请更换"):alert("服务器繁忙，请重试")}):e.showName===t&&s.checkLogin(e.userName,md5(e.userPassword),function(e){0===e.code?redirectToPersonPage():(console.log("login error:",e),alert(e.msg))}),void 0):(alert(i),void 0)},e.resetDialog=function(){r.dialogState=0,e.userName=e.userPassword="",e.userNameTip=e.pswTip=1},e.cancelBubble=function(e){e.stopPropagation()},e.changeLogin=function(){e.showName===a?(e.showName=t,e.showRegisterTip=0,e.showSignTip=1):(e.showName=a,e.showRegisterTip=1,e.showSignTip=0)}});